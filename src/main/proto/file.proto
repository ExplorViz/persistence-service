syntax = "proto3";

option java_multiple_files = true;
option java_package = "net.explorviz.persistence.proto";
option java_outer_classname = "FileProto";

import "google/protobuf/empty.proto";

service FileDataService {
  rpc PersistFile (FileData) returns (google.protobuf.Empty) {}
}

enum Language {
  LANGUAGE_UNSPECIFIED = 0;
  JAVA = 1;
  JAVASCRIPT = 2;
  TYPESCRIPT = 3;
  PYTHON = 4;
}

enum ClassType {
  CLASS_TYPE_UNSPECIFIED = 0;
  CLASS = 1;
  INTERFACE = 2;
  ENUM = 3;
  ABSTRACT_CLASS = 4;
  ANONYMOUS_CLASS = 5;
}

message ParameterData {
  string name = 1;
  string type = 2;
  repeated string modifiers = 3;
}

message FieldData {
  string name = 1;
  string type = 2;
  repeated string modifiers = 3;
}

message FunctionData {
  string name = 1;
  string return_type = 2;
  bool is_constructor = 3;
  repeated string annotations = 4;
  repeated string modifiers = 5;
  repeated ParameterData parameters = 6;
  // Fully qualified method names that are called by this function
  repeated string outgoing_method_calls = 7;
  map<string, double> metrics = 8;
  int32 start_line = 9;
  int32 end_line = 10;
}

message ClassData {
  string name = 1;
  ClassType type = 2;
  repeated string modifiers = 3;
  repeated string implemented_interfaces = 4;
  repeated string superclasses = 5;
  repeated string annotations = 6;
  repeated FieldData fields = 7;
  repeated ClassData inner_classes = 8;
  repeated FunctionData functions = 9;
  repeated string enum_values = 10;

  map<string, double> metrics = 11;
}

message FileData {
  string landscape_token = 1;
  string repository_name = 2;
  string file_hash = 3;

  // Path relative to root of repository
  string file_path = 4;

  Language language = 5;
  optional string package_name = 6;
  repeated string import_names = 7;
  repeated ClassData classes = 8;
  // Top-level / global functions
  repeated FunctionData functions = 9;
  map<string, double> metrics = 10;

  // Author of the last commit touching this file
  string last_editor = 11;

  // Git file metrics
  int32 added_lines = 12;
  int32 modified_lines = 13;
  int32 deleted_lines = 14;
}
